<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TeslaPilot - Sat & Radar Live</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        :root { --tesla-red: #E81922; --glass: rgba(0, 0, 0, 0.85); }
        body, html { margin: 0; padding: 0; height: 100%; background: #000; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; z-index: 1; }

        /* Interface Tesla */
        .ui-overlay {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            z-index: 1000; display: flex; gap: 15px; background: var(--glass);
            padding: 12px 25px; border-radius: 50px; border: 1px solid var(--tesla-red);
            backdrop-filter: blur(10px); box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        .btn { color: white; text-decoration: none; font-size: 14px; font-weight: bold; cursor: pointer; background: none; border: none; outline: none; }
        .btn:hover { color: var(--tesla-red); }
        
        .status-panel {
            position: absolute; bottom: 30px; left: 30px; z-index: 1000;
            background: var(--glass); padding: 15px; border-radius: 12px;
            color: white; border-left: 4px solid var(--tesla-red);
        }
        #clock { font-size: 22px; font-weight: bold; }
        .scan-msg { font-size: 10px; color: var(--tesla-red); text-transform: uppercase; margin-bottom: 5px; }

        /* Style des radars */
        .radar-icon {
            background: var(--tesla-red); border: 2px solid white;
            border-radius: 50%; box-shadow: 0 0 15px var(--tesla-red);
        }
    </style>
</head>
<body>

    <div class="ui-overlay">
        <button class="btn" onclick="map.locate({setView: true, maxZoom: 16})">MA POSITION</button>
        <a href="https://mikefri.github.io/Teslatv/" class="btn">TESLA TV</a>
        <a href="https://www.waze.com/fr/live-map" target="_blank" class="btn" style="color: #33ccff;">WAZE LIVE</a>
    </div>

    <div class="status-panel">
        <div class="scan-msg" id="scanner-status">Scanner Radar: Actif</div>
        <span id="clock">00:00:00</span>
    </div>

    <div id="map"></div>

    <script>
        // 1. Initialisation Carte
        var map = L.map('map', { zoomControl: false }).setView([48.8566, 2.3522], 14);
        
        // Fond Satellite ESRI (Gratuit et Stable)
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            maxZoom: 19
        }).addTo(map);

        // Noms des rues (Labels)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}{r}.png').addTo(map);

        // 2. Système de détection des Radars (Overpass API)
        var radarLayer = L.layerGroup().addTo(map);

        async function fetchRadars() {
            document.getElementById('scanner-status').innerHTML = "Scan en cours...";
            const bounds = map.getBounds();
            const bbox = `${bounds.getSouth()},${bounds.getWest()},${bounds.getNorth()},${bounds.getEast()}`;
            
            // Requête OpenStreetMap pour les radars (speed_camera)
            const query = `[out:json][timeout:25];node["highway"="speed_camera"](${bbox});out body;`;
            const url = "https://overpass-api.de/api/interpreter?data=" + encodeURIComponent(query);

            try {
                const response = await fetch(url);
                const data = await response.json();
                radarLayer.clearLayers();
                
                data.elements.forEach(radar => {
                    L.circleMarker([radar.lat, radar.lon], {
                        radius: 7,
                        fillColor: "#ff0000",
                        color: "#fff",
                        weight: 2,
                        fillOpacity: 1
                    }).addTo(radarLayer).bindPopup(`<b>RADAR FIXE</b><br>Vitesse max: ${radar.tags.maxspeed || 'Inconnue'} km/h`);
                });
                document.getElementById('scanner-status').innerHTML = "Scanner Radar: Prêt";
            } catch (error) {
                document.getElementById('scanner-status').innerHTML = "Erreur Scan";
            }
        }

        // Relancer le scan quand on bouge la carte
        map.on('moveend', fetchRadars);

        // 3. Géolocalisation
        map.locate({setView: true, watch: true, maxZoom: 16});
        map.on('locationfound', function(e) {
            L.circle(e.latlng, 15, {color: 'white', fillColor: '#007AFF', fillOpacity: 0.8}).addTo(map);
        });

        // 4. Horloge
        function updateClock() {
            document.getElementById('clock').innerHTML = new Date().toLocaleTimeString('fr-FR');
        }
        setInterval(updateClock, 1000);
        updateClock();

        // Premier chargement
        fetchRadars();
    </script>
</body>
</html>
