<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RadarCar</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
  html, body { margin:0; padding:0; height:100%; }
  #map { width:100%; height:100%; }
  .radar-alert { 
    position: absolute; top:20%; left:50%; transform:translateX(-50%);
    background:red; color:white; padding:20px; font-size:24px; border-radius:10px;
    display:none;
  }
  .car-icon { width:40px; height:40px; background:red; clip-path: polygon(50% 0%, 0% 100%, 100% 100%); }
</style>
</head>
<body>

<div id="map"></div>
<div id="alert" class="radar-alert">RADAR ðŸš¨</div>

<script>
let map, carMarker, radars = [];
const alertBox = document.getElementById('alert');
const DETECTION_DISTANCE = 500; // en mÃ¨tres

// Exemple de radars statiques (latitude, longitude, vitesse)
radars = [
  {lat:48.8584, lng:2.2945, speed:50}, // Tour Eiffel
  {lat:48.8606, lng:2.3376, speed:30}, // Louvre
];

// Initialisation carte
map = L.map('map', { zoomControl:false }).setView([48.8584,2.2945], 16);

// Fond
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom:19 }).addTo(map);

// Car marker
const carIcon = L.divIcon({className:'car-icon', iconSize:[40,40], iconAnchor:[20,20]});

// Fonction dÃ©clenchement radar
function checkRadars(pos) {
  let alerted = false;
  radars.forEach(r => {
    const radarPos = L.latLng(r.lat, r.lng);
    const dist = pos.distanceTo(radarPos);
    if(dist < DETECTION_DISTANCE) alerted = true;
  });
  alertBox.style.display = alerted ? 'block' : 'none';
}

// Suivi GPS rÃ©el
navigator.geolocation.watchPosition(pos => {
  const latlng = L.latLng(pos.coords.latitude, pos.coords.longitude);

  // Mise Ã  jour carte
  if(!carMarker) {
    carMarker = L.marker(latlng, {icon:carIcon}).addTo(map);
  } else {
    carMarker.setLatLng(latlng);
  }
  map.setView(latlng, map.getZoom(), {animate:true});

  // VÃ©rification radars
  checkRadars(latlng);

}, err => { console.error(err); }, { enableHighAccuracy:true, maximumAge:500, timeout:5000 });
</script>
</body>
</html>
