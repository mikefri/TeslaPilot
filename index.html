<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Radar Debug Desktop</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
html, body { margin:0; height:100%; background:#000; }
#map { width:100%; height:100%; }

.car {
  width:36px;
  height:36px;
  background:#e81922;
  clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
}

.controls {
  position:absolute;
  top:20px;
  right:20px;
  z-index:1000;
  display:flex;
  flex-direction:column;
  gap:10px;
}

.controls button {
  background:#111;
  color:white;
  border:1px solid #555;
  padding:10px 14px;
  border-radius:8px;
  cursor:pointer;
}

#alert {
  position:absolute;
  top:40%;
  left:50%;
  transform:translateX(-50%);
  background:#e81922;
  color:white;
  font-size:28px;
  padding:20px 30px;
  border-radius:15px;
  display:none;
  z-index:1000;
}
</style>
</head>

<body>

<div id="map"></div>
<div id="alert">ðŸš¨ RADAR ðŸš¨</div>

<div class="controls">
  <button onclick="toggleFollow()">AUTO / LIBRE</button>
  <button onclick="recenter()">RECENTRER</button>
</div>

<script>
const DETECT_DISTANCE = 400;
let followCar = true;
let carMarker;
let radarLayer = L.layerGroup();
const alertBox = document.getElementById('alert');

// MAP
const map = L.map('map').setView([48.8566, 2.3522], 14);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
radarLayer.addTo(map);

// CAR INIT (Paris centre)
const carPos = L.latLng(48.8566, 2.3522);
carMarker = L.marker(carPos,{
  icon:L.divIcon({
    className:'',
    html:'<div class="car"></div>',
    iconSize:[36,36],
    iconAnchor:[18,18]
  })
}).addTo(map);

// FAKE RADARS
const radars = [
  [48.8575,2.348],
  [48.854,2.360],
  [48.860,2.355],
  [48.852,2.340]
];

radars.forEach(r=>{
  L.circleMarker(r,{
    radius:6,
    color:'#fff',
    fillColor:'#e81922',
    fillOpacity:1
  }).addTo(radarLayer);
});

// MOVE CAR BY CLICK
map.on('click',e=>{
  carMarker.setLatLng(e.latlng);
  if(followCar) map.setView(e.latlng);
  checkRadar(e.latlng);
});

// RADAR CHECK
function checkRadar(pos){
  let danger = false;
  radarLayer.eachLayer(r=>{
    const d = pos.distanceTo(r.getLatLng());
    if(d < DETECT_DISTANCE) danger = true;
  });
  alertBox.style.display = danger ? 'block' : 'none';
}

// CONTROLS
function toggleFollow(){
  followCar = !followCar;
}

function recenter(){
  followCar = true;
  map.setView(carMarker.getLatLng(), map.getZoom());
}
</script>

</body>
</html>
